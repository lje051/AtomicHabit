
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì£¼ ì‘ì€ ìŠµê´€ GPT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .habit-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .habit-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .card-appear {
            animation: cardAppear 0.5s ease-out;
        }
        
        @keyframes cardAppear {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .response-card {
            animation: responseAppear 0.6s ease-out;
        }
        
        @keyframes responseAppear {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-form {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .form-input:focus {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            outline: none;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8" x-data="habitApp()">
        
        <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ -->
        <div x-show="!isAuthenticated" class="max-w-md mx-auto mt-20">
            <div class="glass-effect rounded-xl p-8 text-white">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold mb-2">ğŸŒ± ì•„ì£¼ ì‘ì€ ìŠµê´€ GPT</h1>
                    <p class="text-white/80">ì‘ì€ ë³€í™”ê°€ ë§Œë“œëŠ” í° ì°¨ì´</p>
                </div>

                <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… íƒ­ -->
                <div class="flex mb-6">
                    <button @click="authMode = 'login'" 
                            :class="authMode === 'login' ? 'bg-white/20' : 'bg-white/10'"
                            class="flex-1 py-2 px-4 rounded-l-lg transition-colors">
                        ë¡œê·¸ì¸
                    </button>
                    <button @click="authMode = 'register'" 
                            :class="authMode === 'register' ? 'bg-white/20' : 'bg-white/10'"
                            class="flex-1 py-2 px-4 rounded-r-lg transition-colors">
                        íšŒì›ê°€ì…
                    </button>
                </div>

                <!-- ë¡œê·¸ì¸ í¼ -->
                <form x-show="authMode === 'login'" @submit.prevent="handleLogin()" class="auth-form space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ì´ë©”ì¼</label>
                        <input type="email" x-model="loginForm.email" required
                               class="w-full px-4 py-3 rounded-lg form-input text-white placeholder-white/60"
                               placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" x-model="loginForm.password" required
                               class="w-full px-4 py-3 rounded-lg form-input text-white placeholder-white/60"
                               placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <button type="submit" :disabled="authLoading"
                            class="w-full bg-white/20 hover:bg-white/30 py-3 rounded-lg font-medium transition-colors disabled:opacity-50">
                        <span x-show="!authLoading">ë¡œê·¸ì¸</span>
                        <span x-show="authLoading">ë¡œê·¸ì¸ ì¤‘...</span>
                    </button>
                </form>

                <!-- íšŒì›ê°€ì… í¼ -->
                <form x-show="authMode === 'register'" @submit.prevent="handleRegister()" class="auth-form space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ì´ë¦„</label>
                        <input type="text" x-model="registerForm.name" required
                               class="w-full px-4 py-3 rounded-lg form-input text-white placeholder-white/60"
                               placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ì´ë©”ì¼</label>
                        <input type="email" x-model="registerForm.email" required
                               class="w-full px-4 py-3 rounded-lg form-input text-white placeholder-white/60"
                               placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" x-model="registerForm.password" required
                               class="w-full px-4 py-3 rounded-lg form-input text-white placeholder-white/60"
                               placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (6ì ì´ìƒ)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                        <input type="password" x-model="registerForm.confirmPassword" required
                               class="w-full px-4 py-3 rounded-lg form-input text-white placeholder-white/60"
                               placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <button type="submit" :disabled="authLoading"
                            class="w-full bg-white/20 hover:bg-white/30 py-3 rounded-lg font-medium transition-colors disabled:opacity-50">
                        <span x-show="!authLoading">íšŒì›ê°€ì…</span>
                        <span x-show="authLoading">ê°€ì… ì¤‘...</span>
                    </button>
                </form>

                <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
                <div x-show="authError" class="mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg">
                    <p class="text-sm text-white" x-text="authError"></p>
                </div>

                <!-- ì„ì‹œ ë¡œê·¸ì¸ ë²„íŠ¼ (ê°œë°œìš©) -->
                <div class="mt-6 pt-6 border-t border-white/20">
                    <button @click="tempLogin()" 
                            class="w-full bg-green-500/20 hover:bg-green-500/30 py-2 rounded-lg text-sm transition-colors">
                        ğŸ”§ ê°œë°œìš© ì„ì‹œ ë¡œê·¸ì¸
                    </button>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ì•± í™”ë©´ (ë¡œê·¸ì¸ í›„) -->
        <div x-show="isAuthenticated">
            <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav class="flex justify-between items-center mb-8">
                <div class="text-white">
                    <span class="text-lg">ì•ˆë…•í•˜ì„¸ìš”, </span>
                    <span class="font-semibold" x-text="user.name"></span>ë‹˜! ğŸ‘‹
                </div>
                <div class="flex space-x-4">
                    <button @click="showProfile = !showProfile" 
                            class="glass-effect px-4 py-2 rounded-lg text-white hover:bg-white/20 transition-colors">
                        í”„ë¡œí•„
                    </button>
                    <button @click="showActivities = !showActivities" 
                            class="glass-effect px-4 py-2 rounded-lg text-white hover:bg-white/20 transition-colors">
                        í™œë™ ë‚´ì—­
                    </button>
                    <button @click="logout()" 
                            class="glass-effect px-4 py-2 rounded-lg text-white hover:bg-white/20 transition-colors">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </nav>

            <!-- í”„ë¡œí•„ ëª¨ë‹¬ -->
            <div x-show="showProfile" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" @click="showProfile = false">
                <div class="glass-effect rounded-xl p-6 text-white max-w-sm w-full mx-4" @click.stop>
                    <h3 class="text-xl font-semibold mb-4">ë‚´ í”„ë¡œí•„</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="text-sm text-white/80">ì´ë¦„</label>
                            <p class="font-medium" x-text="user.name"></p>
                        </div>
                        <div>
                            <label class="text-sm text-white/80">ì´ë©”ì¼</label>
                            <p class="font-medium" x-text="user.email"></p>
                        </div>
                        <div>
                            <label class="text-sm text-white/80">ê°€ì…ì¼</label>
                            <p class="font-medium" x-text="user.joinDate"></p>
                        </div>
                    </div>
                    <button @click="showProfile = false" 
                            class="mt-4 w-full bg-white/20 hover:bg-white/30 py-2 rounded-lg transition-colors">
                        ë‹«ê¸°
                    </button>
                </div>
            </div>

            <!-- í™œë™ ë‚´ì—­ ëª¨ë‹¬ -->
            <div x-show="showActivities" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" @click="showActivities = false">
                <div class="glass-effect rounded-xl p-6 text-white max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden" @click.stop>
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">ë‚´ í™œë™ ë‚´ì—­</h3>
                        <button @click="refreshActivities()" 
                                :disabled="activitiesLoading"
                                class="text-sm bg-white/20 hover:bg-white/30 px-3 py-1 rounded transition-colors disabled:opacity-50">
                            <span x-show="!activitiesLoading">ğŸ”„ ìƒˆë¡œê³ ì¹¨</span>
                            <span x-show="activitiesLoading">ë¡œë”©ì¤‘...</span>
                        </button>
                    </div>
                    
                    <!-- í™œë™ ë‚´ì—­ ëª©ë¡ -->
                    <div class="overflow-y-auto max-h-96 space-y-3" x-show="!activitiesLoading">
                        <template x-if="activities.length === 0">
                            <div class="text-center py-8 text-white/60">
                                <div class="text-3xl mb-2">ğŸ“</div>
                                <p>ì•„ì§ í™œë™ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                <p class="text-sm">ìŠµê´€ì„ ì„ íƒí•˜ê³  ì¶”ì²œì„ ë°›ì•„ë³´ì„¸ìš”!</p>
                            </div>
                        </template>
                        
                        <template x-for="activity in activities" :key="activity.recordedAt">
                            <div class="bg-white/10 rounded-lg p-4 border border-white/20">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex items-center space-x-2">
                                        <span class="text-lg" x-text="getActivityIcon(activity.activity)"></span>
                                        <span class="font-medium text-sm" x-text="getActivityLabel(activity.activity)"></span>
                                    </div>
                                    <span class="text-xs text-white/60" x-text="formatDate(activity.timestamp)"></span>
                                </div>
                                
                                <div class="space-y-1 text-sm">
                                    <div x-show="activity.category" class="flex items-center space-x-2">
                                        <span class="text-white/60">ì¹´í…Œê³ ë¦¬:</span>
                                        <span class="bg-white/20 px-2 py-1 rounded text-xs" x-text="getCategoryLabel(activity.category)"></span>
                                    </div>
                                    <div x-show="activity.habit" class="flex items-center space-x-2">
                                        <span class="text-white/60">ìŠµê´€:</span>
                                        <span class="text-white/80" x-text="activity.habit"></span>
                                    </div>
                                    <div x-show="activity.question" class="mt-2">
                                        <span class="text-white/60">ì§ˆë¬¸:</span>
                                        <p class="text-white/80 mt-1 text-xs bg-white/10 p-2 rounded" x-text="activity.question"></p>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- ë¡œë”© ìƒíƒœ -->
                    <div x-show="activitiesLoading" class="text-center py-8">
                        <div class="text-3xl mb-2">â³</div>
                        <p>í™œë™ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                    
                    <!-- í†µê³„ ì •ë³´ -->
                    <div x-show="activities.length > 0" class="mt-4 pt-4 border-t border-white/20">
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div class="bg-white/10 rounded-lg p-3">
                                <div class="text-lg font-semibold" x-text="activities.length"></div>
                                <div class="text-xs text-white/60">ì´ í™œë™</div>
                            </div>
                            <div class="bg-white/10 rounded-lg p-3">
                                <div class="text-lg font-semibold" x-text="getUniqueCategories()"></div>
                                <div class="text-xs text-white/60">íƒìƒ‰í•œ ì¹´í…Œê³ ë¦¬</div>
                            </div>
                        </div>
                    </div>
                    
                    <button @click="showActivities = false" 
                            class="mt-4 w-full bg-white/20 hover:bg-white/30 py-2 rounded-lg transition-colors">
                        ë‹«ê¸°
                    </button>
                </div>
            </div>

            <!-- í—¤ë” -->
            <header class="text-center mb-12">
                <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">
                    ğŸŒ± ì•„ì£¼ ì‘ì€ ìŠµê´€ GPT
                </h1>
                <p class="text-xl text-white/80 mb-2">ì‘ì€ ë³€í™”ê°€ ë§Œë“œëŠ” í° ì°¨ì´</p>
            </header>

            <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
            <div x-show="selectedCategory" class="mb-6">
                <button @click="goBack()" 
                        class="glass-effect text-white px-4 py-2 rounded-lg hover:bg-white/20 transition-colors">
                    â† ë’¤ë¡œê°€ê¸°
                </button>
            </div>

            <!-- ë©”ì¸ ì¹´í…Œê³ ë¦¬ ì¹´ë“œë“¤ -->
            <div x-show="!selectedCategory" class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="glass-effect rounded-xl p-6 text-white habit-card" 
                     @click="selectCategory('health')">
                    <div class="text-4xl mb-4">ğŸ’ª</div>
                    <h3 class="text-xl font-semibold mb-2">ê±´ê°• ê´€ë¦¬</h3>
                    <p class="text-sm text-white/80">ìš´ë™, ì‹ë‹¨, ìˆ˜ë©´ ê´€ë ¨ ì‘ì€ ìŠµê´€ë“¤</p>
                </div>

                <div class="glass-effect rounded-xl p-6 text-white habit-card" 
                     @click="selectCategory('productivity')">
                    <div class="text-4xl mb-4">âš¡</div>
                    <h3 class="text-xl font-semibold mb-2">ìƒì‚°ì„± í–¥ìƒ</h3>
                    <p class="text-sm text-white/80">ì—…ë¬´ íš¨ìœ¨ì„±ê³¼ ì‹œê°„ ê´€ë¦¬</p>
                </div>

                <div class="glass-effect rounded-xl p-6 text-white habit-card" 
                     @click="selectCategory('stress')">
                    <div class="text-4xl mb-4">ğŸ§˜</div>
                    <h3 class="text-xl font-semibold mb-2">ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬</h3>
                    <p class="text-sm text-white/80">ì •ì‹  ê±´ê°•ê³¼ ê°ì • ì¡°ì ˆ</p>
                </div>

                <div class="glass-effect rounded-xl p-6 text-white habit-card" 
                     @click="selectCategory('energy')">
                    <div class="text-4xl mb-4">ğŸ”‹</div>
                    <h3 class="text-xl font-semibold mb-2">ì—ë„ˆì§€ ì¦ì§„</h3>
                    <p class="text-sm text-white/80">í™œë ¥ê³¼ ì»¨ë””ì…˜ ê°œì„ </p>
                </div>
            </div>

            <!-- ì„¸ë¶€ ì¹´ë“œë“¤ -->
            <div x-show="selectedCategory" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                <template x-for="card in currentCards" :key="card.id">
                    <div class="glass-effect rounded-xl p-6 text-white habit-card card-appear" 
                         @click="selectHabit(card)">
                        <div class="text-3xl mb-4" x-text="card.emoji"></div>
                        <h3 class="text-lg font-semibold mb-2" x-text="card.title"></h3>
                        <p class="text-sm text-white/80" x-text="card.description"></p>
                        <div class="mt-4 text-xs text-white/60">
                            <span class="bg-white/20 px-2 py-1 rounded" x-text="card.duration"></span>
                        </div>
                    </div>
                </template>
            </div>

            <!-- AI ì‘ë‹µ ì¹´ë“œ -->
            <div x-show="aiResponse" class="max-w-4xl mx-auto mb-12">
                <div class="glass-effect rounded-xl p-8 text-white response-card">
                    <div class="flex items-start space-x-4">
                        <div class="text-3xl">ğŸ¤–</div>
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold mb-4" x-text="selectedHabit.title"></h3>
                            <div class="whitespace-pre-wrap leading-relaxed" x-text="aiResponse"></div>
                        </div>
                    </div>
                    
                    <!-- ë‹¤ì‹œ ì¶”ì²œë°›ê¸° ë²„íŠ¼ -->
                    <div class="mt-6 flex justify-center">
                        <button @click="getAnotherRecommendation()" 
                                :disabled="loading"
                                class="bg-white/20 hover:bg-white/30 px-6 py-3 rounded-lg font-medium transition-colors disabled:opacity-50">
                            <span x-show="!loading">ë‹¤ë¥¸ ìŠµê´€ ì¶”ì²œë°›ê¸°</span>
                            <span x-show="loading">ì¶”ì²œ ì¤‘...</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ë¡œë”© ìƒíƒœ -->
            <div x-show="loading && !aiResponse" class="max-w-4xl mx-auto">
                <div class="glass-effect rounded-xl p-8 text-white text-center">
                    <div class="text-3xl mb-4">ğŸ¤–</div>
                    <p class="text-lg mb-4">ë§ì¶¤í˜• ìŠµê´€ì„ ì¶”ì²œí•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                    <div class="flex justify-center space-x-1">
                        <div class="w-2 h-2 bg-white rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                        <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    </div>
                </div>
            </div>

            <!-- ì±„íŒ…ì°½ ì„¹ì…˜ -->
            <div class="max-w-4xl mx-auto mt-16 mb-12">
                <div class="glass-effect rounded-xl p-6 text-white">
                    <h2 class="text-2xl font-bold mb-6 text-center">
                        ğŸ¤– ìŠµê´€ ì½”ì¹˜ì™€ ì±„íŒ…í•˜ê¸°
                    </h2>
                    
                    <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
                    <div class="bg-black/20 rounded-lg p-4 mb-4 h-96 overflow-y-auto" id="chatMessages">
                        <template x-if="chatMessages.length === 0">
                            <div class="text-center text-white/60 mt-20">
                                <div class="text-4xl mb-4">ğŸ’¬</div>
                                <p>ì•ˆë…•í•˜ì„¸ìš”! ìŠµê´€ ê´€ë ¨ ê¶ê¸ˆí•œ ê²ƒì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”.</p>
                                <p class="text-sm mt-2">ì˜ˆ: "ìš´ë™ ìŠµê´€ì„ ë§Œë“¤ê³  ì‹¶ì–´ìš”", "ë¯¸ë£¨ëŠ” ìŠµê´€ì„ ê³ ì¹˜ê³  ì‹¶ì–´ìš”"</p>
                            </div>
                        </template>
                        
                        <template x-for="(message, index) in chatMessages" :key="index">
                            <div class="mb-4" :class="message.role === 'user' ? 'text-right' : 'text-left'">
                                <div class="inline-block max-w-[80%]" :class="message.role === 'user' ? 'ml-auto' : 'mr-auto'">
                                    <div class="flex items-start space-x-3" :class="message.role === 'user' ? 'flex-row-reverse space-x-reverse' : ''">
                                        <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm"
                                             :class="message.role === 'user' ? 'bg-blue-500/30' : 'bg-green-500/30'">
                                            <span x-text="message.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'"></span>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="text-xs text-white/60 mb-1 px-1" 
                                                 :class="message.role === 'user' ? 'text-right' : 'text-left'"
                                                 x-text="message.role === 'user' ? 'ë‚˜' : 'ìŠµê´€ ì½”ì¹˜'"></div>
                                            <div class="rounded-2xl p-4 shadow-lg"
                                                 :class="message.role === 'user' ? 
                                                    'bg-blue-500/30 border border-blue-400/30 rounded-br-md' : 
                                                    'bg-white/10 border border-white/20 rounded-bl-md'">
                                                <div class="whitespace-pre-wrap text-sm leading-relaxed" x-text="message.content"></div>
                                            </div>
                                            <div class="text-xs text-white/40 mt-1 px-1" 
                                                 :class="message.role === 'user' ? 'text-right' : 'text-left'"
                                                 x-text="formatChatTime(message.timestamp)"></div>
                                            <!-- ì„ íƒëœ ìŠµê´€ ì •ë³´ í‘œì‹œ -->
                                            <div x-show="message.selectedCategory || message.selectedHabit" 
                                                 class="mt-2 px-1">
                                                <div class="flex flex-wrap gap-1 text-xs" 
                                                     :class="message.role === 'user' ? 'justify-end' : 'justify-start'">
                                                    <span x-show="message.selectedCategory" 
                                                          class="bg-white/20 px-2 py-1 rounded-full"
                                                          x-text="getCategoryLabel(message.selectedCategory)"></span>
                                                    <span x-show="message.selectedHabit" 
                                                          class="bg-white/30 px-2 py-1 rounded-full"
                                                          x-text="message.selectedHabit"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                        
                        <!-- íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° -->
                        <div x-show="chatLoading" class="text-left mb-4">
                            <div class="inline-block max-w-[80%] mr-auto">
                                <div class="flex items-start space-x-3">
                                    <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-500/30 flex items-center justify-center text-sm">
                                        <span>ğŸ¤–</span>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="text-xs text-white/60 mb-1 px-1">ìŠµê´€ ì½”ì¹˜</div>
                                        <div class="bg-white/10 border border-white/20 rounded-2xl rounded-bl-md p-4">
                                            <div class="flex space-x-1 items-center">
                                                <span class="text-sm text-white/80">ë‹µë³€ ì¤‘</span>
                                                <div class="flex space-x-1 ml-2">
                                                    <div class="w-2 h-2 bg-white/60 rounded-full animate-bounce"></div>
                                                    <div class="w-2 h-2 bg-white/60 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                                    <div class="w-2 h-2 bg-white/60 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ë©”ì‹œì§€ ì…ë ¥ ì˜ì—­ -->
                    <form @submit.prevent="sendChatMessage()" class="flex space-x-3">
                        <input type="text" x-model="chatInput" 
                               :disabled="chatLoading || !isAuthenticated"
                               class="flex-1 px-4 py-3 rounded-lg form-input text-white placeholder-white/60"
                               :placeholder="isAuthenticated ? 'ìŠµê´€ì— ëŒ€í•´ ê¶ê¸ˆí•œ ê²ƒì„ ë¬¼ì–´ë³´ì„¸ìš”...' : 'ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”'">
                        <button type="submit" 
                                :disabled="chatLoading || !chatInput.trim() || !isAuthenticated"
                                class="px-6 py-3 bg-blue-500/30 hover:bg-blue-500/50 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <span x-show="!chatLoading">ì „ì†¡</span>
                            <span x-show="chatLoading">ì „ì†¡ì¤‘...</span>
                        </button>
                    </form>
                    
                    <!-- ë¡œê·¸ì¸ ì•ˆë‚´ -->
                    <div x-show="!isAuthenticated" class="mt-3 text-center text-white/60 text-sm">
                        <p>ğŸ’¡ ë¡œê·¸ì¸í•˜ë©´ ì±„íŒ… ë‚´ì—­ì´ í™œë™ ê¸°ë¡ì— ì €ì¥ë©ë‹ˆë‹¤!</p>
                    </div>
                    
                    <!-- ë¹ ë¥¸ ì§ˆë¬¸ ë²„íŠ¼ë“¤ -->
                    <div x-show="isAuthenticated && chatMessages.length === 0" class="mt-4">
                        <div class="text-sm text-white/60 mb-2">ë¹ ë¥¸ ì§ˆë¬¸:</div>
                        <div class="flex flex-wrap gap-2">
                            <button @click="sendQuickQuestion('ìš´ë™ ìŠµê´€ì„ ë§Œë“¤ê³  ì‹¶ì–´ìš”')" 
                                    class="text-xs bg-white/10 hover:bg-white/20 px-3 py-2 rounded-full transition-colors">
                                ğŸ’ª ìš´ë™ ìŠµê´€ ë§Œë“¤ê¸°
                            </button>
                            <button @click="sendQuickQuestion('ë¯¸ë£¨ëŠ” ìŠµê´€ì„ ê³ ì¹˜ê³  ì‹¶ì–´ìš”')" 
                                    class="text-xs bg-white/10 hover:bg-white/20 px-3 py-2 rounded-full transition-colors">
                                â° ë¯¸ë£¨ëŠ” ìŠµê´€ ê³ ì¹˜ê¸°
                            </button>
                            <button @click="sendQuickQuestion('ì¼ì° ì¼ì–´ë‚˜ëŠ” ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”')" 
                                    class="text-xs bg-white/10 hover:bg-white/20 px-3 py-2 rounded-full transition-colors">
                                ğŸŒ… ì¼ì° ì¼ì–´ë‚˜ê¸°
                            </button>
                            <button @click="sendQuickQuestion('ë…ì„œ ìŠµê´€ì„ ë§Œë“¤ê³  ì‹¶ì–´ìš”')" 
                                    class="text-xs bg-white/10 hover:bg-white/20 px-3 py-2 rounded-full transition-colors">
                                ğŸ“š ë…ì„œ ìŠµê´€ ë§Œë“¤ê¸°
                            </button>
                        </div>
                    </div>
                    
                    <!-- ì±„íŒ… ì´ˆê¸°í™” ë²„íŠ¼ -->
                    <div x-show="chatMessages.length > 0" class="mt-4 text-center">
                        <button @click="clearChat()" 
                                class="text-xs text-white/60 hover:text-white/80 underline transition-colors">
                            ëŒ€í™” ë‚´ì—­ ì§€ìš°ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <!-- í‘¸í„° -->
            <footer class="text-center mt-12 text-white/60">
                <p class="text-sm">
                    ğŸ’¡ íŒ: ìŠµê´€ì€ ì‘ê²Œ ì‹œì‘í•˜ì„¸ìš”. 2ë¶„ ì´ë‚´ë¡œ í•  ìˆ˜ ìˆëŠ” ê²ƒë¶€í„°!
                </p>
            </footer>
        </div>
    </div>

    <script>
      function habitApp() {
    return {
        // ì¸ì¦ ê´€ë ¨ ìƒíƒœ
        isAuthenticated: false,
        authMode: 'login',
        authLoading: false,
        authError: '',
        showProfile: false,
        showActivities: false,
        user: {},
        
        // í™œë™ ë‚´ì—­ ê´€ë ¨ ìƒíƒœ
        activities: [],
        activitiesLoading: false,
        
        // ğŸ†• ì±„íŒ… ê´€ë ¨ ìƒíƒœ
        chatMessages: [],
        chatInput: '',
        chatLoading: false,
        
        // í¼ ë°ì´í„°
        loginForm: {
            email: '',
            password: ''
        },
        registerForm: {
            name: '',
            email: '',
            password: '',
            confirmPassword: ''
        },

        // ê¸°ì¡´ ì•± ìƒíƒœ
        selectedCategory: '',
        selectedHabit: {},
        currentCards: [],
        aiResponse: '',
        loading: false,

        // ì¹´í…Œê³ ë¦¬ë³„ ì„¸ë¶€ ì¹´ë“œ ë°ì´í„°
        cardData: {
            health: [
                { id: 1, emoji: 'ğŸƒâ€â™‚ï¸', title: 'ì•„ì¹¨ ìš´ë™', description: 'í•˜ë£¨ë¥¼ í™œê¸°ì°¨ê²Œ ì‹œì‘í•˜ëŠ” ìš´ë™ ìŠµê´€', duration: '5-10ë¶„', prompt: 'ë§¤ì¼ ì•„ì¹¨ 5-10ë¶„ ê°„ë‹¨í•œ ìš´ë™ ë£¨í‹´' },
                { id: 2, emoji: 'ğŸ¥—', title: 'ê±´ê°•í•œ ì‹ë‹¨', description: 'ì˜ì–‘ ê· í˜•ì„ ë§ì¶˜ ì‹ì‚¬ ìŠµê´€', duration: 'ë§¤ ë¼ë‹ˆ', prompt: 'ê±´ê°•í•œ ì‹ë‹¨ ê´€ë¦¬ì™€ ì˜ì–‘ì†Œ ì„­ì·¨' },
                { id: 3, emoji: 'ğŸ’¤', title: 'ìˆ˜ë©´ ê´€ë¦¬', description: 'ì§ˆ ì¢‹ì€ ì ì„ ìœ„í•œ ìˆ˜ë©´ ìŠµê´€', duration: 'ë§¤ì¼ ë°¤', prompt: 'ìˆ™ë©´ì„ ìœ„í•œ ìˆ˜ë©´ íŒ¨í„´ê³¼ í™˜ê²½ ì¡°ì„±' },
                { id: 4, emoji: 'ğŸ’§', title: 'ë¬¼ ë§ˆì‹œê¸°', description: 'ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨ ìŠµê´€', duration: 'í•˜ë£¨ ì¢…ì¼', prompt: 'ì ì ˆí•œ ìˆ˜ë¶„ ì„­ì·¨ì™€ ë¬¼ ë§ˆì‹œëŠ” ìŠµê´€' },
                { id: 5, emoji: 'ğŸ§˜â€â™€ï¸', title: 'ìŠ¤íŠ¸ë ˆì¹­', description: 'ëª¸ì˜ ê¸´ì¥ì„ í’€ì–´ì£¼ëŠ” ìŠ¤íŠ¸ë ˆì¹­', duration: '5ë¶„', prompt: 'ì¼ìƒ ì† ê°„ë‹¨í•œ ìŠ¤íŠ¸ë ˆì¹­ ë£¨í‹´' },
                { id: 6, emoji: 'ğŸš¶â€â™‚ï¸', title: 'ì‚°ì±…í•˜ê¸°', description: 'ìì—°ê³¼ í•¨ê»˜í•˜ëŠ” ê±·ê¸° ìŠµê´€', duration: '20-30ë¶„', prompt: 'ê·œì¹™ì ì¸ ì‚°ì±…ê³¼ ê±·ê¸° ìš´ë™' }
            ],
            productivity: [
                { id: 1, emoji: 'ğŸ“', title: 'íˆ¬ë‘ë¦¬ìŠ¤íŠ¸', description: 'í•˜ë£¨ í•  ì¼ì„ ì •ë¦¬í•˜ëŠ” ìŠµê´€', duration: '5ë¶„', prompt: 'íš¨ê³¼ì ì¸ í•  ì¼ ëª©ë¡ ì‘ì„±ê³¼ ê´€ë¦¬' },
                { id: 2, emoji: 'ğŸ…', title: 'í¬ëª¨ë„ë¡œ ê¸°ë²•', description: 'ì§‘ì¤‘ë ¥ì„ ë†’ì´ëŠ” ì‹œê°„ ê´€ë¦¬', duration: '25ë¶„', prompt: 'í¬ëª¨ë„ë¡œ ê¸°ë²•ì„ í™œìš©í•œ ì§‘ì¤‘ë ¥ í–¥ìƒ' },
                { id: 3, emoji: 'ğŸ“š', title: 'ë…ì„œí•˜ê¸°', description: 'ì§€ì‹ì„ ëŠ˜ë¦¬ëŠ” ì½ê¸° ìŠµê´€', duration: '15-30ë¶„', prompt: 'ê¾¸ì¤€í•œ ë…ì„œ ìŠµê´€ê³¼ ì§€ì‹ ìŠµë“' },
                { id: 4, emoji: 'ğŸ¯', title: 'ëª©í‘œ ì„¤ì •', description: 'ëª…í™•í•œ ëª©í‘œë¥¼ ì„¸ìš°ëŠ” ìŠµê´€', duration: '10ë¶„', prompt: 'êµ¬ì²´ì ì´ê³  ë‹¬ì„± ê°€ëŠ¥í•œ ëª©í‘œ ì„¤ì •' },
                { id: 5, emoji: 'ğŸ—‚ï¸', title: 'ì •ë¦¬ì •ëˆ', description: 'ì‘ì—… ê³µê°„ì„ ê¹”ë”í•˜ê²Œ ìœ ì§€', duration: '10ë¶„', prompt: 'íš¨ìœ¨ì ì¸ ì‘ì—… ê³µê°„ ì •ë¦¬ì™€ ê´€ë¦¬' },
                { id: 6, emoji: 'â°', title: 'ì‹œê°„ ê´€ë¦¬', description: 'ì‹œê°„ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°', duration: 'ì§€ì†ì ', prompt: 'ì‹œê°„ ê´€ë¦¬ ê¸°ìˆ ê³¼ ìš°ì„ ìˆœìœ„ ì„¤ì •' }
            ],
            stress: [
                { id: 1, emoji: 'ğŸ§˜', title: 'ëª…ìƒí•˜ê¸°', description: 'ë§ˆìŒì˜ í‰í™”ë¥¼ ì°¾ëŠ” ëª…ìƒ', duration: '5-10ë¶„', prompt: 'ì¼ìƒ ì† ê°„ë‹¨í•œ ëª…ìƒê³¼ ë§ˆìŒì±™ê¹€' },
                { id: 2, emoji: 'ğŸŒ¸', title: 'ê°ì‚¬í•˜ê¸°', description: 'ê¸ì •ì ì¸ ë§ˆìŒê°€ì§ ê¸°ë¥´ê¸°', duration: '5ë¶„', prompt: 'ê°ì‚¬ ì¸ì‚¬ì™€ ê¸ì •ì  ì‚¬ê³  ìŠµê´€' },
                { id: 3, emoji: 'ğŸµ', title: 'ìŒì•… ë“£ê¸°', description: 'ë§ˆìŒì„ ë‹¬ë˜ëŠ” ìŒì•… ê°ìƒ', duration: '15-30ë¶„', prompt: 'ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œë¥¼ ìœ„í•œ ìŒì•… í™œìš©' },
                { id: 4, emoji: 'âœï¸', title: 'ì¼ê¸° ì“°ê¸°', description: 'ê°ì •ì„ ì •ë¦¬í•˜ëŠ” ê¸€ì“°ê¸°', duration: '10ë¶„', prompt: 'ê°ì • ì •ë¦¬ì™€ ìê¸° ì„±ì°°ì„ ìœ„í•œ ì¼ê¸°' },
                { id: 5, emoji: 'ğŸŒ¿', title: 'ìì—° ê°ìƒ', description: 'ìì—° ì†ì—ì„œ ë§ˆìŒ íë§í•˜ê¸°', duration: '20ë¶„', prompt: 'ìì—° ì†ì—ì„œ ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œí•˜ê¸°' },
                { id: 6, emoji: 'ğŸ˜Œ', title: 'ì‹¬í˜¸í¡', description: 'ê¹Šì€ í˜¸í¡ìœ¼ë¡œ ë§ˆìŒ ì•ˆì •', duration: '3-5ë¶„', prompt: 'íš¨ê³¼ì ì¸ í˜¸í¡ë²•ê³¼ ì´ì™„ ê¸°ìˆ ' }
            ],
            energy: [
                { id: 1, emoji: 'â˜€ï¸', title: 'ì•„ì¹¨ í–‡ë¹›', description: 'ìì—° ì—ë„ˆì§€ë¡œ í•˜ë£¨ ì‹œì‘', duration: '10ë¶„', prompt: 'ì•„ì¹¨ í–‡ë¹› ì¬ê¸°ì™€ ë¹„íƒ€ë¯¼D í•©ì„±' },
                { id: 2, emoji: 'ğŸ’ª', title: 'íŒŒì›Œ í¬ì¦ˆ', description: 'ìì‹ ê°ì„ ë†’ì´ëŠ” ìì„¸', duration: '2ë¶„', prompt: 'ì—ë„ˆì§€ë¥¼ ë†’ì´ëŠ” íŒŒì›Œ í¬ì¦ˆì™€ ìì„¸' },
                { id: 3, emoji: 'ğŸ¶', title: 'ì‹ ë‚˜ëŠ” ìŒì•…', description: 'ê¸°ë¶„ì„ ì—…ì‹œí‚¤ëŠ” ìŒì•…', duration: '10ë¶„', prompt: 'ì—ë„ˆì§€ ì¶©ì „ì„ ìœ„í•œ ìŒì•… í™œìš©' },
                { id: 4, emoji: 'ğŸ', title: 'ê±´ê°• ê°„ì‹', description: 'ì—ë„ˆì§€ë¥¼ ì£¼ëŠ” ì˜ì–‘ ê°„ì‹', duration: 'ê°„ì‹ì‹œê°„', prompt: 'ì—ë„ˆì§€ ë³´ì¶©ì„ ìœ„í•œ ê±´ê°•í•œ ê°„ì‹' },
                { id: 5, emoji: 'ğŸš¿', title: 'ì°¨ê°€ìš´ ìƒ¤ì›Œ', description: 'í™œë ¥ì„ ì£¼ëŠ” ì°¬ë¬¼ ìƒ¤ì›Œ', duration: '2-3ë¶„', prompt: 'ì—ë„ˆì§€ ë¶€ìŠ¤í„°, ì°¨ê°€ìš´ ìƒ¤ì›Œì˜ íš¨ê³¼' },
                { id: 6, emoji: 'ğŸŒ±', title: 'ìƒˆë¡œìš´ ë„ì „', description: 'ì‘ì€ ë„ì „ìœ¼ë¡œ í™œë ¥ ì°¾ê¸°', duration: 'ë§¤ì¼', prompt: 'ì¼ìƒ ì† ì‘ì€ ë„ì „ê³¼ ì„±ì·¨ê°' }
            ]
        },

        // ì´ˆê¸°í™”
        init() {
            this.checkAuthStatus();
        },

        // ì¸ì¦ ìƒíƒœ í™•ì¸
        checkAuthStatus() {
            const token = localStorage.getItem('authToken');
            const userData = localStorage.getItem('userData');
            
            if (token && userData) {
                this.isAuthenticated = true;
                this.user = JSON.parse(userData);
                // ë¡œê·¸ì¸ ìƒíƒœë¼ë©´ í™œë™ ë‚´ì—­ë„ ë¯¸ë¦¬ ë¡œë“œ
                this.loadActivities();
            }
        },

        // ë¡œê·¸ì¸ ì²˜ë¦¬
        async handleLogin() {
            this.authLoading = true;
            this.authError = '';

            try {
                // ì‹¤ì œ API í˜¸ì¶œ
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    },
                    body: JSON.stringify(this.loginForm)
                });

                const data = await response.json();

                if (response.ok) {
                    // ë¡œê·¸ì¸ ì„±ê³µ
                    localStorage.setItem('authToken', data.token);
                    localStorage.setItem('userData', JSON.stringify(data.user));
                    this.user = data.user;
                    this.isAuthenticated = true;
                    this.resetForms();
                    // ë¡œê·¸ì¸ í›„ í™œë™ ë‚´ì—­ ë¡œë“œ
                    this.loadActivities();
                } else {
                    this.authError = data.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                }
            } catch (error) {
                console.error('Login error:', error);
                this.authError = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
            }

            this.authLoading = false;
        },

        // íšŒì›ê°€ì… ì²˜ë¦¬
        async handleRegister() {
            this.authLoading = true;
            this.authError = '';

            // ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬
            if (!this.registerForm.name.trim()) {
                this.authError = 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                this.authLoading = false;
                return;
            }

            if (!this.registerForm.email.includes('@')) {
                this.authError = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                this.authLoading = false;
                return;
            }

            if (this.registerForm.password.length < 6) {
                this.authError = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                this.authLoading = false;
                return;
            }

            if (this.registerForm.password !== this.registerForm.confirmPassword) {
                this.authError = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                this.authLoading = false;
                return;
            }

            try {
                // ì‹¤ì œ API í˜¸ì¶œ
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: this.registerForm.name.trim(),
                        email: this.registerForm.email.trim().toLowerCase(),
                        password: this.registerForm.password
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // íšŒì›ê°€ì… ì„±ê³µ
                    localStorage.setItem('authToken', data.token);
                    localStorage.setItem('userData', JSON.stringify(data.user));
                    this.user = data.user;
                    this.isAuthenticated = true;
                    this.resetForms();
                    // íšŒì›ê°€ì… í›„ í™œë™ ë‚´ì—­ ì´ˆê¸°í™”
                    this.activities = [];
                } else {
                    this.authError = data.message || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                }
            } catch (error) {
                console.error('Register error:', error);
                this.authError = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
            }

            this.authLoading = false;
        },

        // ì„ì‹œ ë¡œê·¸ì¸ (ê°œë°œìš©)
        tempLogin() {
            const tempUser = {
                id: 'temp_' + Date.now(),
                name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
                email: 'test@example.com',
                joinDate: new Date().toLocaleDateString('ko-KR')
            };
            
            localStorage.setItem('authToken', 'temp-token-' + Date.now());
            localStorage.setItem('userData', JSON.stringify(tempUser));
            this.user = tempUser;
            this.isAuthenticated = true;
            this.resetForms();
            // ì„ì‹œ ë¡œê·¸ì¸ ì‹œ ë¹ˆ í™œë™ ë‚´ì—­
            this.activities = [];
        },

        // ë¡œê·¸ì•„ì›ƒ
        logout() {
            // ì„œë²„ì— ë¡œê·¸ì•„ì›ƒ ìš”ì²­ (ì„ íƒì‚¬í•­)
            const token = localStorage.getItem('authToken');
            if (token && !token.startsWith('temp-token-')) {
                fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                }).catch(err => console.log('Logout request failed:', err));
            }

            // ë¡œì»¬ ë°ì´í„° ì •ë¦¬
            localStorage.removeItem('authToken');
            localStorage.removeItem('userData');
            this.isAuthenticated = false;
            this.user = {};
            this.activities = [];
            this.resetForms();
            this.resetAppState();
        },

        // í¼ ì´ˆê¸°í™”
        resetForms() {
            this.loginForm = { email: '', password: '' };
            this.registerForm = { name: '', email: '', password: '', confirmPassword: '' };
            this.authError = '';
        },

        // ì•± ìƒíƒœ ì´ˆê¸°í™”
        resetAppState() {
            this.selectedCategory = '';
            this.selectedHabit = {};
            this.currentCards = [];
            this.aiResponse = '';
            this.loading = false;
            this.chatMessages = []; // ğŸ†• ì±„íŒ… ë©”ì‹œì§€ë„ ì´ˆê¸°í™”
        },

        // ì¹´í…Œê³ ë¦¬ ì„ íƒ
        selectCategory(category) {
            this.selectedCategory = category;
            this.currentCards = this.cardData[category];
            this.aiResponse = '';
            this.selectedHabit = {};
        },

        // ìŠµê´€ ì„ íƒ
        selectHabit(habit) {
            this.selectedHabit = habit;
            this.getHabitRecommendation(habit);
        },

        // ìŠµê´€ ì¶”ì²œ ê°€ì ¸ì˜¤ê¸°
        async getHabitRecommendation(habit) {
            this.loading = true;
            this.aiResponse = '';

            try {
                const token = localStorage.getItem('authToken');
                
                // Q&A API í˜¸ì¶œ
                const qaResponse = await fetch('/api/habits/qa', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        question: `${habit.prompt}ì— ëŒ€í•´ êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ì•„ì£¼ ì‘ì€ ìŠµê´€ 3ê°œë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”. ê° ìŠµê´€ë§ˆë‹¤ ì‹¤í–‰ ë°©ë²•ê³¼ ê¸°ëŒ€ íš¨ê³¼ë¥¼ í¬í•¨í•´ì„œ ì„¤ëª…í•´ì£¼ì„¸ìš”.`,
                        category: this.selectedCategory,
                        habitType: habit.title
                    })
                });

                const qaData = await qaResponse.json();
                
                if (qaResponse.ok) {
                    this.aiResponse = qaData.answer;
                    // í™œë™ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨ (ìƒˆ í™œë™ì´ ê¸°ë¡ë˜ì—ˆì„ ìˆ˜ ìˆìŒ)
                    if (this.isAuthenticated) {
                        this.loadActivities();
                    }
                } else {
                    throw new Error(qaData.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                }

            } catch (error) {
                console.error('Error getting habit recommendation:', error);
                
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ì‘ë‹µ ì œê³µ
                this.aiResponse = `${habit.title}ì— ëŒ€í•œ ì¶”ì²œì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nê¸°ë³¸ íŒ: ${habit.description}\n\nì¶”ì²œ ì‹œê°„: ${habit.duration}\n\në‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ë‹¤ë¥¸ ìŠµê´€ì„ ì„ íƒí•´ë³´ì„¸ìš”.`;
            }

            this.loading = false;
        },

        // ë‹¤ë¥¸ ì¶”ì²œ ë°›ê¸°
        async getAnotherRecommendation() {
            if (!this.selectedHabit.prompt) return;
            
            this.loading = true;
            this.aiResponse = '';

            try {
                const token = localStorage.getItem('authToken');
                
                const qaResponse = await fetch('/api/habits/qa', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        question: `${this.selectedHabit.prompt}ì— ëŒ€í•´ ì´ì „ê³¼ ë‹¤ë¥¸ ìƒˆë¡œìš´ ì•„ì£¼ ì‘ì€ ìŠµê´€ 3ê°œë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”. ì°½ì˜ì ì´ê³  ì‹¤í–‰í•˜ê¸° ì‰¬ìš´ ë°©ë²•ë“¤ë¡œ ì œì•ˆí•´ì£¼ì„¸ìš”.`,
                        category: this.selectedCategory,
                        habitType: this.selectedHabit.title,
                        requestType: 'alternative'
                    })
                });

                const qaData = await qaResponse.json();
                
                if (qaResponse.ok) {
                    this.aiResponse = qaData.answer;
                    // í™œë™ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨
                    if (this.isAuthenticated) {
                        this.loadActivities();
                    }
                } else {
                    throw new Error(qaData.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                }

            } catch (error) {
                console.error('Error getting alternative recommendation:', error);
                this.aiResponse = 'ìƒˆë¡œìš´ ì¶”ì²œì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            }

            this.loading = false;
        },

        // ë’¤ë¡œê°€ê¸°
        goBack() {
            this.selectedCategory = '';
            this.currentCards = [];
            this.aiResponse = '';
            this.selectedHabit = {};
        },

        // ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ (ì¶”ê°€ ê¸°ëŠ¥)
        async updateProfile(newData) {
            try {
                const token = localStorage.getItem('authToken');
                
                const response = await fetch('/api/user/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(newData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    this.user = { ...this.user, ...data.user };
                    localStorage.setItem('userData', JSON.stringify(this.user));
                    return true;
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Profile update error:', error);
                return false;
            }
        },

        // ì‚¬ìš©ì í™œë™ ê¸°ë¡ (ì¶”ê°€ ê¸°ëŠ¥)
        async logActivity(activity) {
            try {
                const token = localStorage.getItem('authToken');
                
                await fetch('/api/user/activity', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        activity: activity,
                        timestamp: new Date().toISOString(),
                        category: this.selectedCategory,
                        habit: this.selectedHabit.title
                    })
                });
            } catch (error) {
                console.error('Activity logging error:', error);
            }
        },

        // ğŸ†• í™œë™ ë‚´ì—­ ë¡œë“œ
        async loadActivities() {
            if (!this.isAuthenticated) return;
            
            this.activitiesLoading = true;
            
            try {
                const token = localStorage.getItem('authToken');
                
                const response = await fetch('/api/user/activities', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    this.activities = data.activities.sort((a, b) => 
                        new Date(b.timestamp) - new Date(a.timestamp)
                    );
                } else {
                    console.error('í™œë™ ë‚´ì—­ ë¡œë“œ ì‹¤íŒ¨:', response.status);
                }
            } catch (error) {
                console.error('í™œë™ ë‚´ì—­ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
            }
            
            this.activitiesLoading = false;
        },

        // ğŸ†• í™œë™ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨
        async refreshActivities() {
            await this.loadActivities();
        },

        // ğŸ†• í™œë™ ì•„ì´ì½˜ ê°€ì ¸ì˜¤ê¸°
        getActivityIcon(activity) {
            const icons = {
                'habit_qa_request': 'ğŸ’¬',
                'category_selected': 'ğŸ¯',
                'habit_selected': 'âœ¨',
                'recommendation_requested': 'ğŸ¤–',
                'alternative_requested': 'ğŸ”„',
                'chat_conversation': 'ğŸ’­' // ğŸ†• ì±„íŒ… ì•„ì´ì½˜ ì¶”ê°€
            };
            return icons[activity] || 'ğŸ“';
        },

        // ğŸ†• í™œë™ ë¼ë²¨ ê°€ì ¸ì˜¤ê¸°
        getActivityLabel(activity) {
            const labels = {
                'habit_qa_request': 'ìŠµê´€ ì§ˆë¬¸',
                'category_selected': 'ì¹´í…Œê³ ë¦¬ ì„ íƒ',
                'habit_selected': 'ìŠµê´€ ì„ íƒ',
                'recommendation_requested': 'ì¶”ì²œ ìš”ì²­',
                'alternative_requested': 'ë‹¤ë¥¸ ì¶”ì²œ ìš”ì²­',
                'chat_conversation': 'ìŠµê´€ ì½”ì¹˜ ì±„íŒ…' // ğŸ†• ì±„íŒ… ë¼ë²¨ ì¶”ê°€
            };
            return labels[activity] || 'ê¸°íƒ€ í™œë™';
        },

        // ğŸ†• ì¹´í…Œê³ ë¦¬ ë¼ë²¨ ê°€ì ¸ì˜¤ê¸°
        getCategoryLabel(category) {
            const labels = {
                'health': 'ê±´ê°• ê´€ë¦¬',
                'productivity': 'ìƒì‚°ì„± í–¥ìƒ',
                'stress': 'ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬',
                'energy': 'ì—ë„ˆì§€ ì¦ì§„',
                'chat': 'ì±„íŒ…' // ğŸ†• ì±„íŒ… ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            };
            return labels[category] || category;
        },

        // ğŸ†• ë‚ ì§œ í¬ë§·íŒ…
        formatDate(timestamp) {
            try {
                const date = new Date(timestamp);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / (1000 * 60));
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

                if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
                if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
                if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
                if (diffDays < 7) return `${diffDays}ì¼ ì „`;
                
                return date.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch {
                return 'ì•Œ ìˆ˜ ì—†ìŒ';
            }
        },

        // ğŸ†• ê³ ìœ  ì¹´í…Œê³ ë¦¬ ìˆ˜ ê³„ì‚°
        getUniqueCategories() {
            const categories = new Set(
                this.activities
                    .filter(activity => activity.category)
                    .map(activity => activity.category)
            );
            return categories.size;
        },

        // ğŸ†• ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡
        async sendChatMessage() {
            if (!this.chatInput.trim() || this.chatLoading || !this.isAuthenticated) {
                return;
            }

            const userMessage = this.chatInput.trim();
            this.chatInput = '';

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            this.chatMessages.push({
                role: 'user',
                content: userMessage,
                timestamp: new Date().toISOString()
            });

            this.chatLoading = true;
            this.scrollChatToBottom();

            try {
                const token = localStorage.getItem('authToken');
                
                // ì‹œìŠ¤í…œ ë©”ì‹œì§€ì™€ ëŒ€í™” íˆìŠ¤í† ë¦¬ êµ¬ì„±
                const messages = [
                    {
                        role: 'system',
                        content: `ë‹¹ì‹ ì€ ã€ì•„ì£¼ ì‘ì€ ìŠµê´€(Atomic Habits)ã€ ì „ë¬¸ê°€ì´ì ì¹œê·¼í•œ ìŠµê´€ ì½”ì¹˜ì…ë‹ˆë‹¤. 
                    GPTê°€ ì±… ë‚´ìš© ê¸°ë°˜ìœ¼ë¡œ í˜„ì‹¤ì ì¸ í•´ê²°ì±…ê³¼ ë™ê¸°ë¶€ì—¬ ë°©ë²• ì œì•ˆí•˜ê±°ë‚˜ ê²©ë ¤í•´ì¤˜ í•˜ì§€ë§Œ ë„ˆë¬´ ë‹¨ë„ì§ì…ì ìœ¼ë¡œ í•˜ì§€ë§ê³  ìì—°ìŠ¤ëŸ½ê²Œ ì¹œê·¼í•˜ê²Œ ê°€ë”ì€ ì§ˆë¬¸ë„ ë¨¼ì €í•˜ê³  ê³µê°í•´ì¤˜ `
                    },
                    // ìµœê·¼ ëŒ€í™” ë‚´ì—­ í¬í•¨ (ìµœëŒ€ 10ê°œ)
                    ...this.chatMessages.slice(-10).map(msg => ({
                        role: msg.role,
                        content: msg.content
                    }))
                ];

                const response = await fetch('/chat/conversation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ messages })
                });

                const data = await response.json();

                if (response.ok) {
                    // AI ì‘ë‹µ ì¶”ê°€
                    this.chatMessages.push({
                        role: 'assistant',
                        content: data.response,
                        timestamp: new Date().toISOString()
                    });

                    // í™œë™ ê¸°ë¡ (ë¡œê·¸ì¸í•œ ê²½ìš°)
                    await this.logChatActivity(userMessage, data.response);
                    
                    // í™œë™ ë‚´ì—­ ê°±ì‹ 
                    this.loadActivities();
                } else {
                    throw new Error(data.detail || 'ì‘ë‹µì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('Chat error:', error);
                
                // ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ê°€
                this.chatMessages.push({
                    role: 'assistant',
                    content: 'ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
                    timestamp: new Date().toISOString()
                });
            }

            this.chatLoading = false;
            this.scrollChatToBottom();
        },

        // ğŸ†• ë¹ ë¥¸ ì§ˆë¬¸ ì „ì†¡
        async sendQuickQuestion(question) {
            this.chatInput = question;
            await this.sendChatMessage();
        },

        // ğŸ†• ì±„íŒ… í™œë™ ê¸°ë¡
        async logChatActivity(userMessage, aiResponse) {
            if (!this.isAuthenticated) return;
            
            try {
                const token = localStorage.getItem('authToken');
                
                await fetch('/api/user/activity', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        activity: 'chat_conversation',
                        timestamp: new Date().toISOString(),
                        category: 'chat',
                        habit: 'habit_coaching',
                        question: userMessage.length > 100 ? userMessage.substring(0, 100) + '...' : userMessage
                    })
                });
            } catch (error) {
                console.error('Chat activity logging error:', error);
            }
        },

        // ğŸ†• ì±„íŒ… ìŠ¤í¬ë¡¤
        scrollChatToBottom() {
            this.$nextTick(() => {
                const chatContainer = document.getElementById('chatMessages');
                if (chatContainer) {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
            });
        },

        // ğŸ†• ì±„íŒ… ì‹œê°„ í¬ë§·íŒ…
        formatChatTime(timestamp) {
            try {
                const date = new Date(timestamp);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / (1000 * 60));

                if (diffMins < 1) return 'ë°©ê¸ˆ';
                if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
                
                return date.toLocaleTimeString('ko-KR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch {
                return '';
            }
        },

        // ğŸ†• ì±„íŒ… ì´ˆê¸°í™”
        clearChat() {
            if (confirm('ëŒ€í™” ë‚´ì—­ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                this.chatMessages = [];
            }
        }
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€)
async function getData() {
    try {
        const token = localStorage.getItem('authToken');
        
        const response = await fetch("/api/habits/goals", {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            console.log("Fetched data:", data);
        }
    } catch (error) {
        console.log("ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜:", error);
    }
}

// í˜ì´ì§€ ë¡œë“œ ì´ë²¤íŠ¸
window.addEventListener('load', getData);
    </script>
</body>
</html>

